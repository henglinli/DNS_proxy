# Copyright (c) 2011 The LevelDB Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file. See the AUTHORS file for names of contributors.

CXX ?= clang++
CC  ?= clang

#-----------------------------------------------
# Uncomment exactly one of the lines labelled (A), (B), and (C) below
# to switch between compilation modes.

# OPT ?= -O4 -DNDEBUG -Wall      # (A) Production use (optimized mode)
 OPT ?= -O0 -g -Wall               # (B) Debug mode, w/ full line-level debugging symbols
# OPT ?= -O2 -g2 -DNDEBUG -Wall  # (C) Profiling mode: opt, but w/debugging symbols
#-----------------------------------------------
# detect what platform we're building on            
#$(shell sh ./build_detect_platform)
# this file is generated by build_detect_platform to set build flags and sources
#include build_config.mk        
###################################
#defined by users
GTOOLS = $(HOME)/Downloads/src/google_tools/darwin
BOOST = $(HOME)/Downloads/src/boost_1_49_0
###################################
CFLAGS +=  $(OPT) -I$(GTOOLS)/include -I$(BOOST) $(PLATFORM_CCFLAGS)
CXXFLAGS +=  $(OPT) -I$(GTOOLS)/include -I$(BOOST) $(PLATFORM_CCFLAGS)
LDFLAGS +=  -L$(GTOOLS)/lib -L$(BOOST)/stage/lib -lboost_system -lprotobuf -lleveldb $(PLATFORM_LDFLAGS)

PROTOC_BIN = $(GTOOLS)/bin/protoc

LIBOBJECTS = \
	protocol.pb.o \
	utils.o \
	svc_handler.o

BIN = server

LIBRARY = 

UTILS = client oprecord clientc

TEST = 

all: $(BIN) $(UTILS)

test: $(TEST)

.PTHONY: clean help
help: 
	echo "make for $(BIN) $(UTILS) $(TESTS)"
clean:
	-rm -f $(BIN) $(LIBRARY) $(TESTS) $(UTILS)
	-rm -rf *~ a.out *.o *.dSYM
	-rm -rf protocol/*.pb.*

$(LIBRARY): $(LIBOBJECTS)
	rm -f $@
	$(AR) -rs $@ $(LIBOBJECTS)

server: server.o record.o protocol.pb.o resolver.o
	$(CXX) $^ $(LDFLAGS) -o $@

oprecord : oprecord.o record.o protocol.pb.o
	$(CXX) $^ $(LDFLAGS) -o $@

client : client.o resolver.o
	$(CXX) $^ $(LDFLAGS) -o $@
protocol.pb.o:
#	$(PROTOC_BIN) protobuf/protocol.proto --cpp_out=.
	$(CXX) -c $(CFLAGS) protobuf/protocol.pb.cc -o $@

